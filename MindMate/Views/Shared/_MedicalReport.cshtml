@model IEnumerable<dynamic>
@{
    var title = ViewData["ReportTitle"] ?? "Medical Report";
    var patientName = ViewData["PatientName"] ?? "MindMate Patient";
}

<div id="apple-health-report" style="display: none; background: white; padding: 40px; font-family: 'Open Sans', sans-serif; color: #000;">
    <div style="border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 30px;">
        <h1 style="font-size: 32px; font-weight: bold; margin: 0; color: #000;">@patientName</h1>
        <p style="color: #666; margin: 5px 0; font-size: 14px;">
            MindMate Digital Health Record â€¢ @DateTime.Now.ToString("dd MMM yyyy, hh:mm tt")
        </p>
    </div>

    <h2 style="font-size: 22px; font-weight: bold; margin-bottom: 25px; color: #333;">@title</h2>

    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="text-align: left; border-bottom: 1.5px solid #000;">
                <th style="padding: 12px 5px; font-weight: bold;">Activity / Medication</th>
                <th style="padding: 12px 5px; font-weight: bold;">Schedule</th>
                <th style="padding: 12px 5px; font-weight: bold;">Details</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 18px 5px;">
                        <strong style="font-size: 16px; display: block;">
                            @(item.GetType().GetProperty("Name")?.GetValue(item) ?? item.GetType().GetProperty("ActivityName")?.GetValue(item))
                        </strong>
                    </td>
                    <td style="padding: 18px 5px; font-size: 15px;">
                        @(item.GetType().GetProperty("Time")?.GetValue(item)?.ToString("hh:mm tt") ?? 
                          item.GetType().GetProperty("ScheduledTime")?.GetValue(item)?.ToString("hh:mm tt"))
                    </td>
                    <td style="padding: 18px 5px; font-size: 14px; color: #444;">
                        @if (item.GetType().GetProperty("Dosage") != null) { 
                            <span>Dose: @item.Dosage</span> 
                        } else { 
                            <span>Daily Care Activity</span> 
                        }
                        @if (item.GetType().GetProperty("IsCompleted")?.GetValue(item) is bool completed && completed) {
                            <span style="color: green; margin-left: 10px;">(Completed)</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div style="margin-top: 60px; border-top: 1px solid #eee; padding-top: 10px; font-size: 10px; color: #999; text-align: center;">
        This document is generated by MindMate for informational purposes only.
    </div>
</div>